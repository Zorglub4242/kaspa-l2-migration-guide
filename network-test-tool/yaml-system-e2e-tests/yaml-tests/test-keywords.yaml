
# Test keyword library
keywords:
  setup-test-tokens:
    description: "Setup test tokens with initial distribution"
    params: [tokenSupply, recipients]
    steps:
      - deploy: token = ERC20("TestToken", "TEST", {{tokenSupply}})
      - foreach:
          item: recipient
          in: "{{recipients}}"
        do:
          - token.transfer: "deployer -> {{recipient}}, 1000"
      - return: "{{token}}"

  check-balance-range:
    description: "Check if balance is within range"
    params: [account, min, max]
    steps:
      - get: "balance = balance({{account}})"
      - assert: "{{balance}} >= {{min}}"
      - assert: "{{balance}} <= {{max}}"
      - return: "{{balance}}"

  multi-transfer:
    description: "Transfer to multiple recipients"
    params: [from, recipients, amount]
    steps:
      - foreach:
          item: recipient
          in: "{{recipients}}"
        do:
          - transfer: "{{from}} -> {{recipient}}, {{amount}}"
      - log: "Transferred {{amount}} to {{recipients.length}} recipients"

  swap-tokens:
    description: "Simulate a token swap"
    params: [tokenA, tokenB, amountA, user]
    steps:
      - call: "{{tokenA}}.balanceOf({{user}})"
        returns: initialA
      - call: "{{tokenB}}.balanceOf({{user}})"
        returns: initialB
      - token.transfer: "{{user}} -> deployer, {{amountA}}"
        from: "{{user}}"
      - set:
          amountB: "{{amountA}} * 2"  # 1:2 exchange rate
      - token.transfer: "deployer -> {{user}}, {{amountB}}"
      - return:
          sent: "{{amountA}}"
          received: "{{amountB}}"
          rate: 2
